
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://heal-docs-dev.io/notebooks/Monitoring_The_Future_12th_Grader_Opiate_Use_2012-2021/">
      
      <link rel="icon" href="../../img/heal_logo.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>MTF 12th Grader Opiate Use In 2012-2021 - HEAL Example Analysis</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Montserrat";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="heal_platform" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#monitoring-the-future-12th-grader-opiate-use-from-2012-to-2021-part-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://healdata.org" title="HEAL Example Analysis" class="md-header__button md-logo" aria-label="HEAL Example Analysis" data-md-component="logo">
      
  <img src="../../assets/HEAL_Initiative_White-cropped.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HEAL Example Analysis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MTF 12th Grader Opiate Use In 2012-2021
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://healdata.org" title="HEAL Example Analysis" class="md-nav__button md-logo" aria-label="HEAL Example Analysis" data-md-component="logo">
      
  <img src="../../assets/HEAL_Initiative_White-cropped.svg" alt="logo">

    </a>
    HEAL Example Analysis
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://healdata.org/" class="md-nav__link">
        Return to Platform
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Example Analysis Notebooks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Example Analysis Notebooks" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Example Analysis Notebooks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../BACPAC_Synthetic_Data_Analysis/" class="md-nav__link">
        BACPAC Synthetic Data Analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Stigma-Reduction-Among_PCCs/" class="md-nav__link">
        Stigma Reduction Among PCCs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Opioid_Risk_Metric_Threshold_Identification-Study_Recreation/" class="md-nav__link">
        Opioid Risk Metric Threshold Identification - Study Recreation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Opioid_Prevalence_And_Overdoses/" class="md-nav__link">
        Opioid Prevalence And Overdoses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../High-Resolution-Spinal-Cord-Stimulation-for-Non-Opioid-Treatment-of-Neuropathic-Pain/" class="md-nav__link">
        Non-Opioid Treatment Of Neuropathic Pain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Monitoring_The_Future_12th_Grader_Opiate_Use_In_2019/" class="md-nav__link">
        MTF 12th Grader Opiate Use In 2019
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          MTF 12th Grader Opiate Use In 2012-2021
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        MTF 12th Grader Opiate Use In 2012-2021
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#by-j-montgomery-maxwell-data-science-sr-analyst-ctds" class="md-nav__link">
    By J Montgomery Maxwell - Data Science, Sr. Analyst - CTDS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-introduction" class="md-nav__link">
    Analysis Introduction
  </a>
  
    <nav class="md-nav" aria-label="Analysis Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about-the-data" class="md-nav__link">
    About The Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-preperation" class="md-nav__link">
    Data Preperation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-and-visualization" class="md-nav__link">
    Analysis And Visualization
  </a>
  
    <nav class="md-nav" aria-label="Analysis And Visualization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#annual-oppiate-use-rate" class="md-nav__link">
    Annual Oppiate Use Rate
  </a>
  
    <nav class="md-nav" aria-label="Annual Oppiate Use Rate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rate-of-illicit-substance-use-coinciding-with-opiate-abuse" class="md-nav__link">
    Rate Of Illicit Substance Use Coinciding With Opiate Abuse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annual-cocaine-use-rate" class="md-nav__link">
    Annual Cocaine Use Rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annual-tranquilzer-use-rate" class="md-nav__link">
    Annual Tranquilzer Use Rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annual-sedatives-use-rate" class="md-nav__link">
    Annual Sedatives Use Rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annual-amphetamines-use-rate" class="md-nav__link">
    Annual Amphetamines Use Rate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-validation-hyperparameter-tuning-and-model-selection" class="md-nav__link">
    Cross Validation, Hyperparameter Tuning, And Model Selection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opioid-use-classification" class="md-nav__link">
    Opioid Use Classification
  </a>
  
    <nav class="md-nav" aria-label="Opioid Use Classification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-performance" class="md-nav__link">
    Model Performance
  </a>
  
    <nav class="md-nav" aria-label="Model Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-scores" class="md-nav__link">
    Model Scores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confuion-matrix" class="md-nav__link">
    Confuion Matrix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#most-important-features" class="md-nav__link">
    Most Important Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#least-important-features" class="md-nav__link">
    Least Important Features
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        FAQs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        Contact
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#by-j-montgomery-maxwell-data-science-sr-analyst-ctds" class="md-nav__link">
    By J Montgomery Maxwell - Data Science, Sr. Analyst - CTDS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-introduction" class="md-nav__link">
    Analysis Introduction
  </a>
  
    <nav class="md-nav" aria-label="Analysis Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#about-the-data" class="md-nav__link">
    About The Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-preperation" class="md-nav__link">
    Data Preperation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis-and-visualization" class="md-nav__link">
    Analysis And Visualization
  </a>
  
    <nav class="md-nav" aria-label="Analysis And Visualization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#annual-oppiate-use-rate" class="md-nav__link">
    Annual Oppiate Use Rate
  </a>
  
    <nav class="md-nav" aria-label="Annual Oppiate Use Rate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rate-of-illicit-substance-use-coinciding-with-opiate-abuse" class="md-nav__link">
    Rate Of Illicit Substance Use Coinciding With Opiate Abuse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annual-cocaine-use-rate" class="md-nav__link">
    Annual Cocaine Use Rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annual-tranquilzer-use-rate" class="md-nav__link">
    Annual Tranquilzer Use Rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annual-sedatives-use-rate" class="md-nav__link">
    Annual Sedatives Use Rate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#annual-amphetamines-use-rate" class="md-nav__link">
    Annual Amphetamines Use Rate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-validation-hyperparameter-tuning-and-model-selection" class="md-nav__link">
    Cross Validation, Hyperparameter Tuning, And Model Selection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opioid-use-classification" class="md-nav__link">
    Opioid Use Classification
  </a>
  
    <nav class="md-nav" aria-label="Opioid Use Classification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-performance" class="md-nav__link">
    Model Performance
  </a>
  
    <nav class="md-nav" aria-label="Model Performance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-scores" class="md-nav__link">
    Model Scores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#confuion-matrix" class="md-nav__link">
    Confuion Matrix
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#most-important-features" class="md-nav__link">
    Most Important Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#least-important-features" class="md-nav__link">
    Least Important Features
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="monitoring-the-future-12th-grader-opiate-use-from-2012-to-2021-part-2">Monitoring The Future: 12th Grader Opiate Use From 2012 To 2021 - Part 2<a class="headerlink" href="#monitoring-the-future-12th-grader-opiate-use-from-2012-to-2021-part-2" title="Permanent link">&para;</a></h1>
<h4 id="by-j-montgomery-maxwell-data-science-sr-analyst-ctds">By J Montgomery Maxwell - Data Science, Sr. Analyst - CTDS<a class="headerlink" href="#by-j-montgomery-maxwell-data-science-sr-analyst-ctds" title="Permanent link">&para;</a></h4>
<h2 id="analysis-introduction">Analysis Introduction<a class="headerlink" href="#analysis-introduction" title="Permanent link">&para;</a></h2>
<h3 id="about-the-data">About The Data<a class="headerlink" href="#about-the-data" title="Permanent link">&para;</a></h3>
<p>The Monitoring The Future surveys are a series of surveys that have emerged as a vital tool in measuring the values, behaviors, and lifestyle orientations of American youth. Through a comprehensive series of surveys, these studies offer a unique glimpse into the ever-changing landscape of 12th grade students. There are approximately 1,400 variables across all of the questionnaires; while recognizing the vastness of the available data, our exploration will be primarily focused on a subset of variables deemed particularly relevant to our research.</p>
<p>One of the critical aspects examined in the surveys pertains to the frequency of drug use among students, encompassing a wide array of illicit and recreational substances. In the context of this analysis, specific attention has been limited to surveys which observe instances where students engaged in the use of heroin or other opioid narcotics.</p>
<p>While the investigation of drug use patterns holds significance in understanding the landscape of contemporary American youth, the Monitoring The Future surveys provide a broader canvas for exploration. Our analysis incorporates other topics including, but not limited to, students' perspectives on religion, educational goals, family life dynamics, and work habits. By examining these multidimensional facets, we may gain a holistic understanding of the myriad factors influencing the lives, aspirations, and substance use risks of American students.</p>
<div class="highlight"><pre><span></span><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">seaborn</span> <span class="o">-</span><span class="n">q</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">matplotlib</span> <span class="o">-</span><span class="n">q</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">scikit</span><span class="o">-</span><span class="n">learn</span> <span class="o">-</span><span class="n">q</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">xgboost</span> <span class="o">-</span><span class="n">q</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">imblearn</span> <span class="o">-</span><span class="n">q</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">resample</span>

<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">SMOTE</span>
<span class="kn">from</span> <span class="nn">imblearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;future.no_silent_downcasting&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;img/MTF_Part2&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
</code></pre></div>
<h2 id="data-preperation">Data Preperation<a class="headerlink" href="#data-preperation" title="Permanent link">&para;</a></h2>
<p>As in our previous work, we exclude a number of variables due to their strong correlations. For instance, we observed among the survey recipients an expected connection between the number of alcoholic drinks consumed this year and the number of alcoholic drinks consumed in the last 30 days. We believe that the latter variable will serve as a more robust indicator for opiate use, so to streamline our analysis and enhance the veracity of our work, we made the decision to remove the former variable.</p>
<p>After removing a number of observations that were missing data, we were left with approximately 42,000 observations spanning the 10 years of survey data.</p>
<p>Most of the data you see below is either recorded as a binary outcome (1/yes or 0/no), as an ordinal value(i.e., 0 = no drug use, 1 = some drug use, 2 = frequent drug use), or as a categorical feature. The categorical data is encoded and represented as binary data, and the ordinal values were scaled down so that all of the data was within the range of 0 and 1.</p>
<div class="highlight"><pre><span></span><code><span class="n">random_seed</span><span class="o">=</span><span class="mi">2023</span>

<span class="n">variable_dict</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s1">&#39;V1&#39;</span><span class="p">:</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span>
 <span class="s1">&#39;RESPONDENT_AGE&#39;</span><span class="p">:</span> <span class="s1">&#39;Over18&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V13&#39;</span><span class="p">:</span> <span class="s1">&#39;SchoolRegion&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V49&#39;</span><span class="p">:</span> <span class="s1">&#39;NumberOfSiblings&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2102&#39;</span><span class="p">:</span> <span class="s1">&#39;Cigarettes/30Days&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2106&#39;</span><span class="p">:</span> <span class="s1">&#39;AlcoholicDrinks/30Days&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2117&#39;</span><span class="p">:</span> <span class="s1">&#39;Marijuana/30Days&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2118&#39;</span><span class="p">:</span> <span class="s1">&#39;LSD/Lifetime&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2121&#39;</span><span class="p">:</span> <span class="s1">&#39;Psychedelics/Lifetime&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2124&#39;</span><span class="p">:</span> <span class="s1">&#39;Cocaine/Lifetime&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2127&#39;</span><span class="p">:</span> <span class="s1">&#39;Amphetamines/Lifetime&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2133&#39;</span><span class="p">:</span> <span class="s1">&#39;Sedatives/Lifetime&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2136&#39;</span><span class="p">:</span> <span class="s1">&#39;Tranquilizers/Lifetime&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2139&#39;</span><span class="p">:</span> <span class="s1">&#39;Heroine/Lifetime&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2142&#39;</span><span class="p">:</span> <span class="s1">&#39;OpioidNarcotics/Lifetime&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2150&#39;</span><span class="p">:</span> <span class="s1">&#39;Sex&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2151&#39;</span><span class="p">:</span> <span class="s1">&#39;Race&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2152&#39;</span><span class="p">:</span> <span class="s1">&#39;RaisedWhere&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2153&#39;</span><span class="p">:</span> <span class="s1">&#39;MaritalStatus&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2155&#39;</span><span class="p">:</span> <span class="s1">&#39;LivesWithFather&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2156&#39;</span><span class="p">:</span> <span class="s1">&#39;LivesWithMother&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2157&#39;</span><span class="p">:</span> <span class="s1">&#39;LivesWithSiblings&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2163&#39;</span><span class="p">:</span> <span class="s1">&#39;FatherEduLvl&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2164&#39;</span><span class="p">:</span> <span class="s1">&#39;MotherEduLvl&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2165&#39;</span><span class="p">:</span> <span class="s1">&#39;MotherHadPaidJobWhileGrowingUp&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2166&#39;</span><span class="p">:</span> <span class="s1">&#39;PoliticalPreference&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2167&#39;</span><span class="p">:</span> <span class="s1">&#39;PoliticalBeliefs&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2169&#39;</span><span class="p">:</span> <span class="s1">&#39;ReligiousServiceAttendenceWkly&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2170&#39;</span><span class="p">:</span> <span class="s1">&#39;ReligionImportance&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2172&#39;</span><span class="p">:</span> <span class="s1">&#39;HighSchoolProgram&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2174&#39;</span><span class="p">:</span> <span class="s1">&#39;SelfRateIntelligence&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2175&#39;</span><span class="p">:</span> <span class="s1">&#39;SchoolDaysMissedIllness/4Weeks&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2176&#39;</span><span class="p">:</span> <span class="s1">&#39;SchoolDaysMissedSkipped/4Weeks&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2177&#39;</span><span class="p">:</span> <span class="s1">&#39;SchoolDaysMissedOther/4Weeks&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2178&#39;</span><span class="p">:</span> <span class="s1">&#39;SkippedClass/4Weeks&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2179&#39;</span><span class="p">:</span> <span class="s1">&#39;AverageGradeHS&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2180&#39;</span><span class="p">:</span> <span class="s1">&#39;LikelyToAttendVocationalSchl&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2181&#39;</span><span class="p">:</span> <span class="s1">&#39;LikelyToServeInMilitary&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2182&#39;</span><span class="p">:</span> <span class="s1">&#39;LikelyToGraduate2YrCollege&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2183&#39;</span><span class="p">:</span> <span class="s1">&#39;LikelyToGraduate4YrCollege&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2184&#39;</span><span class="p">:</span> <span class="s1">&#39;LikelyToAttendGraduateSchl&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2185&#39;</span><span class="p">:</span> <span class="s1">&#39;WantToDoVocationalSchl&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2186&#39;</span><span class="p">:</span> <span class="s1">&#39;WantToServeInMilitary&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2187&#39;</span><span class="p">:</span> <span class="s1">&#39;WantToDo2YrCollege&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2188&#39;</span><span class="p">:</span> <span class="s1">&#39;WantToDo4YrCollege&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2189&#39;</span><span class="p">:</span> <span class="s1">&#39;WantToDoGradSchl&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2190&#39;</span><span class="p">:</span> <span class="s1">&#39;WantToDoNo2ndEd&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2191&#39;</span><span class="p">:</span> <span class="s1">&#39;HrsWorkedPerWeek&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2193&#39;</span><span class="p">:</span> <span class="s1">&#39;MoneyFromOtherSource&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2194&#39;</span><span class="p">:</span> <span class="s1">&#39;EveningsOutPerWeek&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2195&#39;</span><span class="p">:</span> <span class="s1">&#39;DatesHowOften&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2196&#39;</span><span class="p">:</span> <span class="s1">&#39;MilesDrivenPerWeek&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2197&#39;</span><span class="p">:</span> <span class="s1">&#39;DrivingTickets&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2201&#39;</span><span class="p">:</span> <span class="s1">&#39;CarAccidentsLast12Mo&#39;</span><span class="p">,</span>
 <span class="s1">&#39;V2459&#39;</span><span class="p">:</span> <span class="s1">&#39;Crack/Lifetime&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">df_2012</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_34861/DS0001/34861-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2013</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_35218/DS0001/35218-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2014</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_36263/DS0001/36263-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2015</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_36408/DS0001/36408-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2016</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_36798/DS0001/36798-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2017</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_37182/DS0001/37182-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2018</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_37416/DS0001/37416-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2019</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_37841/DS0001/37841-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2020</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_38156/DS0001/38156-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">df_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Grade12/ICPSR_38503/DS0001/38503-0001-Data.tsv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">df_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_2012</span><span class="p">,</span> <span class="n">df_2013</span><span class="p">,</span> <span class="n">df_2014</span><span class="p">,</span> <span class="n">df_2015</span><span class="p">,</span> <span class="n">df_2016</span><span class="p">,</span> <span class="n">df_2017</span><span class="p">,</span> <span class="n">df_2018</span><span class="p">,</span> <span class="n">df_2019</span><span class="p">,</span> <span class="n">df_2020</span><span class="p">,</span> <span class="n">df_2021</span><span class="p">]</span>
<span class="n">year_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">2013</span><span class="p">,</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2020</span><span class="p">,</span> <span class="mi">2021</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nb">vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_2012</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
<span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">df_list</span><span class="p">:</span>
    <span class="nb">vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">vars</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">variables</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_list</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">variable_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

<span class="c1"># Remove missing data</span>
<span class="n">missing_criteria</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">missing_criteria</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">missing_criteria</span><span class="p">]]</span>

<span class="n">minimal_missing</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">9</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">minimal_missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">minimal_missing</span><span class="p">)]</span>

<span class="c1"># Combine Opiate Use data</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;V2142&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;V2139&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;V2142&#39;</span><span class="p">,</span> <span class="s1">&#39;V2139&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Rename columns using data dictionary</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">variable_dict</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Factor categorical data</span>
<span class="n">dummy_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SchoolRegion&#39;</span><span class="p">,</span> <span class="s1">&#39;Race&#39;</span><span class="p">,</span> <span class="s1">&#39;RaisedWhere&#39;</span><span class="p">,</span> <span class="s1">&#39;MaritalStatus&#39;</span><span class="p">,</span> <span class="s1">&#39;PoliticalPreference&#39;</span><span class="p">,</span> <span class="s1">&#39;PoliticalBeliefs&#39;</span><span class="p">,</span> <span class="s1">&#39;HighSchoolProgram&#39;</span><span class="p">]</span>
<span class="n">dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">dummy_cols</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">dummy_cols</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">dummies</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">dummy_cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Normalize data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="kc">False</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">years_vec</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">years_vec</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<h2 id="analysis-and-visualization">Analysis And Visualization<a class="headerlink" href="#analysis-and-visualization" title="Permanent link">&para;</a></h2>
<h3 id="annual-oppiate-use-rate">Annual Oppiate Use Rate<a class="headerlink" href="#annual-oppiate-use-rate" title="Permanent link">&para;</a></h3>
<p>Here we find a steady decline in opiate use rates amongst the surveyed 12th graders. There is a significant drop in opiate abuse in 2021, however this abnormal decrease could be from a number of outlying conditions such as the COVID-19 pandemic and the subsequent stay at home orders and work from home school policies.</p>
<div class="highlight"><pre><span></span><code><span class="n">series</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Opiate Use Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;img/MTF_Part2/figure1.png&#39;</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;img/MTF_Part2/figure1.png&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../img/MTF_Part2/figure1.png" /></p>
<h4 id="rate-of-illicit-substance-use-coinciding-with-opiate-abuse">Rate Of Illicit Substance Use Coinciding With Opiate Abuse<a class="headerlink" href="#rate-of-illicit-substance-use-coinciding-with-opiate-abuse" title="Permanent link">&para;</a></h4>
<p>Below we can see that more than half of all those surveyed who had ever used tranquilzers, cocaine, and pychedelics had also abused opiates or opioid narcotics at somepoint in their lives. Rates of coinciding sedative, amphetamine, and LSD use are not far behind.</p>
<div class="highlight"><pre><span></span><code><span class="n">drug_use_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Tranquilizers/Lifetime&#39;</span><span class="p">,</span> <span class="s1">&#39;Amphetamines/Lifetime&#39;</span><span class="p">,</span> <span class="s1">&#39;Sedatives/Lifetime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Marijuana/30Days&#39;</span><span class="p">,</span> <span class="s1">&#39;Cocaine/Lifetime&#39;</span><span class="p">,</span> <span class="s1">&#39;Cigarettes/30Days&#39;</span><span class="p">,</span> <span class="s1">&#39;Psychedelics/Lifetime&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AlcoholicDrinks/30Days&#39;</span><span class="p">,</span> <span class="s1">&#39;LSD/Lifetime&#39;</span><span class="p">,</span> <span class="s1">&#39;OpiateUse&#39;</span><span class="p">]]</span>

<span class="n">ratio_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">drug_use_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">drug_use_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[((</span><span class="n">drug_use_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drug_use_df</span><span class="p">[</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">drug_use_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">drug_use_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ratio_dict</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span>
<span class="n">ratio_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">ratio_dict</span>
</code></pre></div>
<pre><code>{'Tranquilizers/Lifetime': 0.5340777820562187,
 'Amphetamines/Lifetime': 0.41908396946564885,
 'Sedatives/Lifetime': 0.47626186906546725,
 'Marijuana/30Days': 0.21841463414634146,
 'Cocaine/Lifetime': 0.600326264274062,
 'Cigarettes/30Days': 0.29249941217963793,
 'Psychedelics/Lifetime': 0.5078625509609784,
 'AlcoholicDrinks/30Days': 0.14727359585067903,
 'LSD/Lifetime': 0.4786096256684492}
</code></pre>
<p>If readers are familiar with the previous analysis on the HEAL platform: <em>Monitoring The Future: 12th Grader Opiate Use - Part 1</em>, an undeniable connection was identified by the machine learning models used in that notebook between opioid abuse and other drug use for 12th graders in 2019. While that connection appears to exist again, let's examine if the same descrease in opioid use is present with other drug use amongst 12th graders.</p>
<h3 id="annual-cocaine-use-rate">Annual Cocaine Use Rate<a class="headerlink" href="#annual-cocaine-use-rate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">series</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Cocaine/Lifetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Cocaine Use Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;img/MTF_Part2/figure2.png&#39;</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;img/MTF_Part2/figure2.png&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../img/MTF_Part2/figure2.png" /></p>
<h3 id="annual-tranquilzer-use-rate">Annual Tranquilzer Use Rate<a class="headerlink" href="#annual-tranquilzer-use-rate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">series</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Tranquilizers/Lifetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Tranquilizer Use Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;img/MTF_Part2/figure3.png&#39;</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;img/MTF_Part2/figure3.png&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../img/MTF_Part2/figure3.png" /></p>
<h3 id="annual-sedatives-use-rate">Annual Sedatives Use Rate<a class="headerlink" href="#annual-sedatives-use-rate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">series</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Sedatives/Lifetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Sedatives Use Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;img/MTF_Part2/figure4.png&#39;</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;img/MTF_Part2/figure4.png&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../img/MTF_Part2/figure4.png" /></p>
<h3 id="annual-amphetamines-use-rate">Annual Amphetamines Use Rate<a class="headerlink" href="#annual-amphetamines-use-rate" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">series</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Amphetamines/Lifetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Amphetamines Use Rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;img/MTF_Part2/figure5.png&#39;</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;img/MTF_Part2/figure5.png&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../img/MTF_Part2/figure5.png" /></p>
<p>While there is a substantial decrease in the use of amphetamines, sedatives, tranquilizers, and cocaine in 2021, we do not see the same slow decline in their usage from 2012 to 2020. It is, however, worth noting the significant degree to which opioids are abused compared to the other illicit substances. Opiate use peaked at over 11% in 2012, while all of the other substances have peaks between 1% and 6%.</p>
<p>*<em>Opiate use is a combined measurement of the heroin and opioid narcotic use survey results.</em></p>
<h2 id="cross-validation-hyperparameter-tuning-and-model-selection">Cross Validation, Hyperparameter Tuning, And Model Selection<a class="headerlink" href="#cross-validation-hyperparameter-tuning-and-model-selection" title="Permanent link">&para;</a></h2>
<p>The work done in the first example analysis notebook in this series used SMOTE (Synthetic Minority Oversampling Technique) and multiple, simpler classification models, such as logistic regression and random forest classification. This notebook will use the XGB (Extreme Gradient Boosting) classification algorithm. Unlike with the simpler models used previously, the XGBClassifier does not require the use of SMOTE. Instead, we will use the XGBClassifier hyperparameter, 'scale_pos_weight'. When classes are imbalanced, 'scale_pos_weight' is typically set as the ratio of the number of overrepresented observations (no opiate use) to the number of underrepresented observations (opiate use). This hyperparameter scales the gradient of the positive, underrepresented class, thus scaling the errors of the positive class during the model training step.</p>
<p>While 'scale_pos_weight' is taken at the suggested value, most of the other hyperparameters to the XGBClassifier model were tuned using the grid search and 10-fold cross validation methods. In other words, we exhaustively tested multiple combinations of hyperparameters from a subset of possible values and verified the optimal combination of hyperparameters using 10-fold cross validation.</p>
<p>Below you will find the function used for cross validation and the final model used with the tuned hyperparameters.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pipeline_cross_validation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">pipeline_steps</span><span class="p">):</span>

    <span class="n">folds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">accuracySum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">recallSum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">precisionSum</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">train</span> <span class="o">=</span> <span class="n">folds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">folds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">train</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">y_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">OpiateUse</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">y_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">OpiateUse</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pipeline_steps</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

        <span class="n">accuracySum</span> <span class="o">+=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">recallSum</span> <span class="o">+=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">precisionSum</span> <span class="o">+=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>


    <span class="k">return</span> <span class="p">[</span><span class="n">accuracySum</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="n">recallSum</span><span class="o">/</span><span class="n">k</span><span class="p">,</span> <span class="n">precisionSum</span><span class="o">/</span><span class="n">k</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span>
    <span class="n">learning_rate</span> <span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">min_child_weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">subsample</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">objective</span><span class="o">=</span> <span class="s1">&#39;binary:logistic&#39;</span><span class="p">,</span>
    <span class="n">enable_categorical</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">,</span>
    <span class="n">scale_pos_weight</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">]))</span>

<span class="n">steps</span> <span class="o">=</span>  <span class="p">[(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)]</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">pipeline_cross_validation</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pipeline_steps</span> <span class="o">=</span> <span class="n">steps</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accuracy: </span><span class="si">{</span><span class="n">score</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> | Precision: </span><span class="si">{</span><span class="n">score</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> | Recall: </span><span class="si">{</span><span class="n">score</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<pre><code>Accuracy: 0.8603258289775144 | Precision: 0.7657892432458844 | Recall: 0.31582818104175825
</code></pre>
<h2 id="opioid-use-classification">Opioid Use Classification<a class="headerlink" href="#opioid-use-classification" title="Permanent link">&para;</a></h2>
<p>This first iteration of model training, testing, and evaluation will use all 10 years of data spaning from 2012 to 2021. This model will be the same XGBClassifier that was tuned and validated above. After the model is trained, we will examine the model's performance by looking at the model's accuracy, precision, and recall metrics. Model accuracy will tell us the model's rate of correctly classifying both the students who have and have not ever abused opiates; model recall will tell us the model's rate of correctly identifying all of the students who have abused opiates, and model precision will tell us the model's rate of correctly identifying students who have abused opiates amongst all students the model identifies as having used opiates.</p>
<p>After examining the model's performance and the corresponding confusion matrix, we will look at what the model considers to be the most and least relevant features to capturing students' opiate use behavior.</p>
<div class="highlight"><pre><span></span><code><span class="n">X</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">OpiateUse</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_seed</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span>
 <span class="n">learning_rate</span> <span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
 <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
 <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
 <span class="n">min_child_weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
 <span class="n">gamma</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
 <span class="n">subsample</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
 <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
 <span class="n">objective</span><span class="o">=</span> <span class="s1">&#39;binary:logistic&#39;</span><span class="p">,</span>
 <span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">,</span>
 <span class="n">scale_pos_weight</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">]))</span>

<span class="n">steps</span> <span class="o">=</span>  <span class="p">[(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)]</span>

<span class="n">boosted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">boosted_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</code></pre></div>
<h3 id="model-performance">Model Performance<a class="headerlink" href="#model-performance" title="Permanent link">&para;</a></h3>
<p>The following model scores are scaled between 0 and 1, with 1 being perfect performance. The scores and the corresponding confusion matrix tells us that the model performs relatively well at identifying students who have ever used opiates illicitly, identifying almost 78% of all students who have used opiates illicitly, and performs well at correctly classifying 85% of all students in either category. However, the model does a poor job at identifying only those who abused opioids amongst the student population. In fact, almost 70% of the students our model says have used opioids illicitly have not.</p>
<h4 id="model-scores">Model Scores<a class="headerlink" href="#model-scores" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Accuracy: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">}</span><span class="s1"> | Precision: </span><span class="si">{</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">}</span><span class="s1"> | Recall: </span><span class="si">{</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
<pre><code>Accuracy: 0.8550380821575727 | Precision: 0.31851360318513605 | Recall: 0.7817589576547231
</code></pre>
<h4 id="confuion-matrix">Confuion Matrix<a class="headerlink" href="#confuion-matrix" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">disp</span> <span class="o">=</span> <span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
<span class="n">disp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">disp</span><span class="o">.</span><span class="n">im_</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">disp</span><span class="o">.</span><span class="n">figure_</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;img/MTF_Part2/figure6.png&#39;</span><span class="p">)</span>
<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;img/MTF_Part2/figure6.png&quot;</span><span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="../img/MTF_Part2/figure6.png" /></p>
<h2 id="most-important-features">Most Important Features<a class="headerlink" href="#most-important-features" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df1</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">))</span>
<span class="n">feature_importance</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Feature Importance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">boosted_model</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">boosted_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">boosted_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">boosted_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">))</span>
<span class="n">Markdown</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">Feature Importance</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Amphetamines/Lifetime</td>
<td align="right">1</td>
</tr>
<tr>
<td align="left">Tranquilizers/Lifetime</td>
<td align="right">0.449333</td>
</tr>
<tr>
<td align="left">Marijuana/30Days</td>
<td align="right">0.335475</td>
</tr>
<tr>
<td align="left">Sedatives/Lifetime</td>
<td align="right">0.152119</td>
</tr>
<tr>
<td align="left">AlcoholicDrinks/30Days</td>
<td align="right">0.129192</td>
</tr>
<tr>
<td align="left">Cigarettes/30Days</td>
<td align="right">0.105862</td>
</tr>
<tr>
<td align="left">LivesWithSiblings</td>
<td align="right">0.0666517</td>
</tr>
<tr>
<td align="left">Psychedelics/Lifetime</td>
<td align="right">0.0630031</td>
</tr>
<tr>
<td align="left">Cocaine/Lifetime</td>
<td align="right">0.0601336</td>
</tr>
<tr>
<td align="left">MilesDrivenPerWeek</td>
<td align="right">0.0462572</td>
</tr>
<tr>
<td align="left">LSD/Lifetime</td>
<td align="right">0.0363287</td>
</tr>
<tr>
<td align="left">DrivingTickets</td>
<td align="right">0.0314236</td>
</tr>
<tr>
<td align="left">SkippedClass/4Weeks</td>
<td align="right">0.02358</td>
</tr>
<tr>
<td align="left">MoneyFromOtherSource</td>
<td align="right">0.0222268</td>
</tr>
<tr>
<td align="left">LivesWithMother</td>
<td align="right">0.021669</td>
</tr>
</tbody>
</table>
<h2 id="least-important-features">Least Important Features<a class="headerlink" href="#least-important-features" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">Markdown</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">Feature Importance</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">PoliticalPreference_2</td>
<td align="right">0.00565269</td>
</tr>
<tr>
<td align="left">MotherEduLvl</td>
<td align="right">0.00560381</td>
</tr>
<tr>
<td align="left">PoliticalBeliefs_2</td>
<td align="right">0.00553094</td>
</tr>
<tr>
<td align="left">MotherHadPaidJobWhileGrowingUp</td>
<td align="right">0.00535169</td>
</tr>
<tr>
<td align="left">RaisedWhere_9</td>
<td align="right">0.00510992</td>
</tr>
<tr>
<td align="left">Crack/Lifetime</td>
<td align="right">0.00484198</td>
</tr>
<tr>
<td align="left">HrsWorkedPerWeek</td>
<td align="right">0.00477158</td>
</tr>
<tr>
<td align="left">DatesHowOften</td>
<td align="right">0.00447595</td>
</tr>
<tr>
<td align="left">RaisedWhere_4</td>
<td align="right">0.00430372</td>
</tr>
<tr>
<td align="left">RaisedWhere_8</td>
<td align="right">0.00428398</td>
</tr>
<tr>
<td align="left">HighSchoolProgram_4</td>
<td align="right">0.00370746</td>
</tr>
<tr>
<td align="left">MaritalStatus_2</td>
<td align="right">0.00318217</td>
</tr>
<tr>
<td align="left">Over18</td>
<td align="right">0.00306294</td>
</tr>
<tr>
<td align="left">PoliticalPreference_3</td>
<td align="right">0.00255435</td>
</tr>
<tr>
<td align="left">PoliticalPreference_7</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Above we see the 15 most and least important features ranked by their normalized feature importance scores. These feature scores are an indication of the relative amount each feature improves upon the performance of the model when making a decision along the given feature. As with our work in part one, we find that the students' use of other illicit substances are the most telling indicators as to whether a student will use opiates or opioid narcotics. We also find that the students race, political preference or beliefs, and where students are raised gives little to no indication towards whether they will abuse opioids.</p>
<h1 id="annual-opioid-use-classification">Annual Opioid Use Classification<a class="headerlink" href="#annual-opioid-use-classification" title="Permanent link">&para;</a></h1>
<p>Next we will rerun this analysis but focus on only one year of data at a time. We will use the same hyperparameters as before for these newly trained models, since the computation for hyperparameter tuning takes a significant amount of time. After training the 10 models for the 10 years of data, we will again examine the models' performance and ranked feature importance.</p>
<h2 id="training-and-testing-model-on-annual-data">Training And Testing Model On Annual Data<a class="headerlink" href="#training-and-testing-model-on-annual-data" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="n">feature_importance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df1</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">))</span>
<span class="n">classification_scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">,</span> <span class="s1">&#39;Precision&#39;</span><span class="p">,</span> <span class="s1">&#39;Recall&#39;</span><span class="p">]})</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">year_list</span><span class="p">:</span>

    <span class="n">df_annual</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
    <span class="n">df_annual</span> <span class="o">=</span> <span class="n">df_annual</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">df_annual</span> <span class="o">=</span> <span class="n">df_annual</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">df_annual</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_annual</span><span class="o">.</span><span class="n">OpiateUse</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_seed</span><span class="p">)</span>


    <span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span>
        <span class="n">learning_rate</span> <span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">min_child_weight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">gamma</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
        <span class="n">subsample</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">objective</span><span class="o">=</span> <span class="s1">&#39;binary:logistic&#39;</span><span class="p">,</span>
        <span class="n">enable_categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">,</span>
        <span class="n">scale_pos_weight</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_annual</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">df_annual</span><span class="p">[</span><span class="s1">&#39;OpiateUse&#39;</span><span class="p">]))</span>

    <span class="n">boosted_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">boosted_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="n">feature_importance</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Feature Importance </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">boosted_model</span><span class="o">.</span><span class="n">feature_importances_</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">boosted_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">boosted_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">boosted_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">))</span>
    <span class="n">classification_scores</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Model Performance </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span>  <span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">),</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)]</span>
</code></pre></div>
<h2 id="annual-accuracy-and-precision-scores">Annual Accuracy And Precision Scores<a class="headerlink" href="#annual-accuracy-and-precision-scores" title="Permanent link">&para;</a></h2>
<p>Below we can see that for the first few years our model's performance is only slightly below the previous performance of the model using all 10 years of data. In 2020 and 2021, the models do not perform nearly as well as the models trained on prior annual data or the model trained using all of the data. The underperformance of the models from earlier years compared to our first model is to be expected, as we are training those models on a much smaller subset of data. However, the poor performance of the later models cannot be completely explained by the difference in size of the training data. The lower performance of the models from 2020 and 2021 may be explained by the disruption to behavior caused by the COVID-19 pandemic, but may also be exlpained by the massive decrease in the opioid use rate of the 12th graders surveyed in 2021.</p>
<div class="highlight"><pre><span></span><code><span class="n">Markdown</span><span class="p">(</span><span class="n">classification_scores</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">Metric</th>
<th align="right">Model Performance 2012</th>
<th align="right">Model Performance 2013</th>
<th align="right">Model Performance 2014</th>
<th align="right">Model Performance 2015</th>
<th align="right">Model Performance 2016</th>
<th align="right">Model Performance 2017</th>
<th align="right">Model Performance 2018</th>
<th align="right">Model Performance 2019</th>
<th align="right">Model Performance 2020</th>
<th align="right">Model Performance 2021</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">Accuracy</td>
<td align="right">0.864261</td>
<td align="right">0.871503</td>
<td align="right">0.892216</td>
<td align="right">0.89576</td>
<td align="right">0.891626</td>
<td align="right">0.917513</td>
<td align="right">0.91247</td>
<td align="right">0.911633</td>
<td align="right">0.921875</td>
<td align="right">0.9681</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">Precision</td>
<td align="right">0.444444</td>
<td align="right">0.42246</td>
<td align="right">0.476923</td>
<td align="right">0.351852</td>
<td align="right">0.391667</td>
<td align="right">0.488636</td>
<td align="right">0.344086</td>
<td align="right">0.358696</td>
<td align="right">0.388889</td>
<td align="right">0.4</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">Recall</td>
<td align="right">0.75188</td>
<td align="right">0.669492</td>
<td align="right">0.738095</td>
<td align="right">0.44186</td>
<td align="right">0.758065</td>
<td align="right">0.68254</td>
<td align="right">0.727273</td>
<td align="right">0.622642</td>
<td align="right">0.4375</td>
<td align="right">0.555556</td>
</tr>
</tbody>
</table>
<h2 id="most-important-features-each-year">Most important features each year<a class="headerlink" href="#most-important-features-each-year" title="Permanent link">&para;</a></h2>
<p>Like before, we see the same relation between between general illicit substance use and illicit opiate use. It is worth noting that the use of tranqulizers and amphetamines typically took the top 1 and 2 positions for most influential features until 2021, when they fell to the 4th and 5th ranking. This is another indicator that something significant shifted in our model's classification of 12th grader opiate use.</p>
<div class="highlight"><pre><span></span><code><span class="n">df12</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2012&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2012&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df12</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2012&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df12</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df12</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2012&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df12</span> <span class="o">=</span> <span class="n">df12</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df13</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2013&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2013&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df13</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2013&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df13</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df13</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2013&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df13</span> <span class="o">=</span> <span class="n">df13</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df14</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2014&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2014&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df14</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2014&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df14</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df14</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2014&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df14</span> <span class="o">=</span> <span class="n">df14</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df15</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2015&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2015&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df15</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2015&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df15</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df15</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2015&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df15</span> <span class="o">=</span> <span class="n">df15</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df16</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2016&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2016&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df16</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2016&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df16</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df16</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2016&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df16</span> <span class="o">=</span> <span class="n">df16</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df17</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2017&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2017&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df17</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2017&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df17</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df17</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2017&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df17</span> <span class="o">=</span> <span class="n">df17</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df18</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2018&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2018&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df18</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2018&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df18</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df18</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2018&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df18</span> <span class="o">=</span> <span class="n">df18</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df19</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2019&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2019&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df19</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2019&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df19</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df19</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2019&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df19</span> <span class="o">=</span> <span class="n">df19</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df20</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2020&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2020&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df20</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2020&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df20</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df20</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2020&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df20</span> <span class="o">=</span> <span class="n">df20</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df21</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_importance</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2021&#39;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s1">&#39;Feature Importance 2021&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">])</span>
<span class="n">df21</span><span class="p">[</span><span class="s1">&#39;Feature Importance 2021&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df21</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s2">&quot; - &quot;</span><span class="o">+</span> <span class="n">df21</span><span class="p">[</span><span class="s2">&quot;Feature Importance 2021&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df21</span> <span class="o">=</span> <span class="n">df21</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Feature&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Markdown</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df12</span> <span class="p">,</span><span class="n">df13</span><span class="p">,</span> <span class="n">df14</span><span class="p">,</span> <span class="n">df15</span><span class="p">,</span> <span class="n">df16</span><span class="p">,</span> <span class="n">df17</span><span class="p">,</span> <span class="n">df18</span><span class="p">,</span> <span class="n">df19</span><span class="p">,</span> <span class="n">df20</span><span class="p">,</span> <span class="n">df21</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">Feature Importance 2012</th>
<th align="left">Feature Importance 2013</th>
<th align="left">Feature Importance 2014</th>
<th align="left">Feature Importance 2015</th>
<th align="left">Feature Importance 2016</th>
<th align="left">Feature Importance 2017</th>
<th align="left">Feature Importance 2018</th>
<th align="left">Feature Importance 2019</th>
<th align="left">Feature Importance 2020</th>
<th align="left">Feature Importance 2021</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">Amphetamines/Lifetime - 1.0</td>
<td align="left">Amphetamines/Lifetime - 1.0</td>
<td align="left">Amphetamines/Lifetime - 1.0</td>
<td align="left">Amphetamines/Lifetime - 1.0</td>
<td align="left">Amphetamines/Lifetime - 1.0</td>
<td align="left">Tranquilizers/Lifetime - 1.0</td>
<td align="left">Tranquilizers/Lifetime - 1.0</td>
<td align="left">Tranquilizers/Lifetime - 1.0</td>
<td align="left">Tranquilizers/Lifetime - 1.0</td>
<td align="left">Psychedelics/Lifetime - 1.0</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">Marijuana/30Days - 0.75576615</td>
<td align="left">Tranquilizers/Lifetime - 0.55172384</td>
<td align="left">Tranquilizers/Lifetime - 0.5155145</td>
<td align="left">Tranquilizers/Lifetime - 0.32245028</td>
<td align="left">Tranquilizers/Lifetime - 0.49392527</td>
<td align="left">Amphetamines/Lifetime - 0.87034947</td>
<td align="left">Amphetamines/Lifetime - 0.34006974</td>
<td align="left">Amphetamines/Lifetime - 0.46549627</td>
<td align="left">Amphetamines/Lifetime - 0.82667917</td>
<td align="left">Sedatives/Lifetime - 0.9135607</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">Tranquilizers/Lifetime - 0.65975815</td>
<td align="left">Sedatives/Lifetime - 0.35604864</td>
<td align="left">Marijuana/30Days - 0.3510031</td>
<td align="left">Marijuana/30Days - 0.27957878</td>
<td align="left">Marijuana/30Days - 0.30306983</td>
<td align="left">Marijuana/30Days - 0.4922091</td>
<td align="left">Marijuana/30Days - 0.20515968</td>
<td align="left">AlcoholicDrinks/30Days - 0.26642838</td>
<td align="left">Sedatives/Lifetime - 0.60782486</td>
<td align="left">LSD/Lifetime - 0.70153475</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">Sedatives/Lifetime - 0.23304458</td>
<td align="left">Cigarettes/30Days - 0.22533654</td>
<td align="left">Sedatives/Lifetime - 0.24436365</td>
<td align="left">Cigarettes/30Days - 0.26259112</td>
<td align="left">Crack/Lifetime - 0.1769505</td>
<td align="left">Cigarettes/30Days - 0.3307903</td>
<td align="left">DrivingTickets - 0.12938854</td>
<td align="left">LSD/Lifetime - 0.25456077</td>
<td align="left">Marijuana/30Days - 0.36239895</td>
<td align="left">Tranquilizers/Lifetime - 0.66015655</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">AlcoholicDrinks/30Days - 0.16919222</td>
<td align="left">Marijuana/30Days - 0.22409648</td>
<td align="left">AlcoholicDrinks/30Days - 0.19529353</td>
<td align="left">Cocaine/Lifetime - 0.23002389</td>
<td align="left">Sedatives/Lifetime - 0.17548333</td>
<td align="left">Sedatives/Lifetime - 0.28806037</td>
<td align="left">Sedatives/Lifetime - 0.121947214</td>
<td align="left">Marijuana/30Days - 0.2489249</td>
<td align="left">PoliticalBeliefs_6 - 0.33769482</td>
<td align="left">Marijuana/30Days - 0.52852654</td>
</tr>
<tr>
<td align="right">5</td>
<td align="left">Cigarettes/30Days - 0.15726869</td>
<td align="left">AlcoholicDrinks/30Days - 0.1261193</td>
<td align="left">Psychedelics/Lifetime - 0.1708248</td>
<td align="left">Psychedelics/Lifetime - 0.22408944</td>
<td align="left">LSD/Lifetime - 0.14090925</td>
<td align="left">DrivingTickets - 0.26170564</td>
<td align="left">PoliticalPreference_6 - 0.11954165</td>
<td align="left">Psychedelics/Lifetime - 0.19040935</td>
<td align="left">WantToDo2YrCollege - 0.3267634</td>
<td align="left">Amphetamines/Lifetime - 0.49161762</td>
</tr>
<tr>
<td align="right">6</td>
<td align="left">Crack/Lifetime - 0.15701917</td>
<td align="left">PoliticalPreference_7 - 0.1104126</td>
<td align="left">Cocaine/Lifetime - 0.17024292</td>
<td align="left">RaisedWhere_1 - 0.17279556</td>
<td align="left">PoliticalBeliefs_6 - 0.12900716</td>
<td align="left">Crack/Lifetime - 0.21362005</td>
<td align="left">LivesWithSiblings - 0.117574446</td>
<td align="left">Cocaine/Lifetime - 0.15222396</td>
<td align="left">LSD/Lifetime - 0.31751463</td>
<td align="left">RaisedWhere_7 - 0.4318025</td>
</tr>
<tr>
<td align="right">7</td>
<td align="left">WantToServeInMilitary - 0.14331344</td>
<td align="left">MaritalStatus_2 - 0.10724328</td>
<td align="left">PoliticalPreference_7 - 0.16727918</td>
<td align="left">Sedatives/Lifetime - 0.1554664</td>
<td align="left">AlcoholicDrinks/30Days - 0.12395912</td>
<td align="left">Cocaine/Lifetime - 0.19935064</td>
<td align="left">Cocaine/Lifetime - 0.10532992</td>
<td align="left">WantToServeInMilitary - 0.15194388</td>
<td align="left">SchoolDaysMissedIllness/4Weeks - 0.29573283</td>
<td align="left">PoliticalPreference_7 - 0.42327297</td>
</tr>
<tr>
<td align="right">8</td>
<td align="left">Psychedelics/Lifetime - 0.14275527</td>
<td align="left">Psychedelics/Lifetime - 0.10488076</td>
<td align="left">MaritalStatus_3 - 0.15278761</td>
<td align="left">PoliticalBeliefs_6 - 0.14911336</td>
<td align="left">PoliticalBeliefs_8 - 0.11484937</td>
<td align="left">SkippedClass/4Weeks - 0.18681203</td>
<td align="left">RaisedWhere_7 - 0.10298768</td>
<td align="left">Cigarettes/30Days - 0.1502413</td>
<td align="left">SkippedClass/4Weeks - 0.29407594</td>
<td align="left">WantToDoVocationalSchl - 0.39966732</td>
</tr>
<tr>
<td align="right">9</td>
<td align="left">LivesWithSiblings - 0.13939653</td>
<td align="left">RaisedWhere_8 - 0.083930984</td>
<td align="left">DrivingTickets - 0.15190427</td>
<td align="left">SchoolRegion_3 - 0.1441104</td>
<td align="left">Over18 - 0.11348703</td>
<td align="left">SchoolRegion_3 - 0.16396773</td>
<td align="left">MoneyFromOtherSource - 0.102316245</td>
<td align="left">SkippedClass/4Weeks - 0.14667954</td>
<td align="left">DatesHowOften - 0.28880978</td>
<td align="left">SchoolRegion_2 - 0.38491154</td>
</tr>
</tbody>
</table>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>Using the XGBoost (extreme gradient boosting) classifier algorithm and cross-validation techniques, we successfully tuned, trained, and tested an XGBClassifier model on survey data from 2012 to 2021 for classifying whether a student surveyed had ever opioids illicitly. The model trained using all 10 years of data had a fairly high model accuracy score of 0.86 and a model recall score of 0.77 during cross-validation. In other words, the model correctly identified whether a student had or had not ever illicitly used opioids 86% of the time and correctly identified 77% of the students who had used opioids illicitly.</p>
<p>Following our model fitting, testing, and feature analysis on all 10 years of data, we refit our model on each year of data seperately, keeping the same hyperparameter tunings.  While many of these annual models did not perform as well as the initial model with all 10 years worth of data, this can easily be explained by differences in the size of the training datasets. However, the models for 2020 and 2021 performed poorly even when compared to the models trained on the previous years data; this suggests some additioanl influence is taking place upon the survey data for 2020 and 2021. The two most obvious influences would be the significant decrease in the reported rate of opioid use in 2021 and the possible effects of the COVID-19 pandemic on the survey methodology and/or the changes in the actual behavior of the surveyed 12th graders.</p>
<p>Like with our previous work in part one of this series, many of the identified important variables aligned with expectations, both when modeling the annual datasets and the entire dataset spanning from 2012 to 2021. It was not surprising to find that students who engaged in various illicit drug use and underage drinking were at higher risk of using opiates and heroin. It is worth noting: from 2012 to 2016, use of amphetamine, followed by the use of tranquilizers, was considered by the models to be the best indicator of opioid use. From 2017 to 2020, those positions switched. In 2021, the use of amphetamine and tranquilizers became a significantly less influential indicator.</p>
<h3 id="future-work">Future Work<a class="headerlink" href="#future-work" title="Permanent link">&para;</a></h3>
<p>Future work is planned to further analyze the lifestyle, behaviors, and opiate use of the survey subjects from 2021. Particular emphasis will be placed on examining what other behavioral and lifestyle changes occured amongst 12th graders that might coincide with the decreased rate of illicit opiate use as found amongst the MTF survey participants.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../Monitoring_The_Future_12th_Grader_Opiate_Use_In_2019/" class="md-footer__link md-footer__link--prev" aria-label="Previous: MTF 12th Grader Opiate Use In 2019" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              MTF 12th Grader Opiate Use In 2019
            </div>
          </div>
        </a>
      
      
        
        <a href="../../faq/" class="md-footer__link md-footer__link--next" aria-label="Next: FAQs" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              FAQs
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.indexes", "navigation.tracking"], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.37e9125f.min.js"></script>
      
    
  </body>
</html>